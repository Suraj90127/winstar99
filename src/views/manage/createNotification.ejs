<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Notification Record</title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback"
    />
    <link rel="stylesheet" href="/plugins/fontawesome-free/css/all.min.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      href="//cdn.jsdelivr.net/npm/@sweetalert2/theme-dark@4/dark.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/dist/css/adminlte.min.css" />
    <link rel="stylesheet" href="/css/admin.css" />
    <style>
      body {
        background-color: #f4f6f9;
        color: #343a40;
      }
      a {
        color: #605bff;
        text-decoration: none;
        background-color: #192434;
        padding: 8px 12px;
        border-radius: 4px;
        transition: background-color 0.3s ease, color 0.3s ease;
      }
      a:hover {
        background-color: #22baa6;
        color: white;
      }
      .content-wrapper {
        background-color: #ffffff;
        color: #333;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
      }
      .card-title {
        color: #605bff;
        font-size: 20px;
        font-weight: bold;
        margin-bottom: 10px;
      }
      tbody tr:nth-child(odd) {
        background: #f3f2ff !important;
      }
      thead tr {
        background-color: #605bff;
      }
      thead th {
        background-color: #605bff;
        color: white;
      }
      .table-responsive {
        overflow-x: auto;
      }
    </style>
  </head>
  <body class="hold-transition sidebar-mini">
    <div class="wrapper">
      <!-- Include navigation -->
      <%- include('nav') %>
      <div class="content-wrapper">
        <section class="content-header">
          <div class="container-fluid">
            <div class="row mb-2">
              <div class="col-sm-6">
                <h1 style="color: #605bff; font-size: 2rem; font-weight: bold">
                  Created Notification Record
                </h1>
              </div>
            </div>
          </div>
        </section>

        <!-- Main content -->
        <section class="content">
          <div class="card card-bg">
            <div class="card-body">
              <div>
                <div class="mb-3">
                  <label for="title" class="form-label">Title</label>
                  <input
                    type="text"
                    class="form-control"
                    id="title"
                    name="title"
                    required
                    placeholder="Enter Title"
                  />
                </div>
                <div class="mb-3">
                  <label for="description" class="form-label">Description</label>
                  <textarea
                    class="form-control"
                    id="description"
                    name="description"
                    required
                    placeholder="Enter description"
                    style="width: 100%; height: 150px"
                  ></textarea>
                </div>
                <button
                  class="btn bg-green btn-primary"
                  onclick="handleSubmit()"
                >
                  Submit
                </button>
              </div>
            </div>
          </ </div>

          <div class="card">
            <div class="card-body p-0 mt-2">
              <h5 class="card-title ml-2">Notification Records Table</h5>
              <div class="table-responsive">
                <table class="table" id="tableget">
                  <thead>
                    <tr>
                      <th class="text-center">#</th>
                      <th class="text-center">Title</th>
                      <th class="text-center" style="width: 350px">Description</th>
                      <th class="text-center">Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- Add your table rows dynamically here -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>

    <script src="/plugins/jquery/jquery.min.js"></script>
    <script src="/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="/dist/js/adminlte.min.js"></script>
    <script src="/js/admin/admin.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
    <script>
      function handleSubmit(e) {
        console.log($("#title").val());
        let title = $("#title").val().trim().replace(/\s+/g, " ");
        let description = $("#description").val().trim().replace(/\s+/g, " ");

        $.ajax({
          type: "POST",
          url: "/api/webapi/admin/create-notification",
          dataType: "JSON",
          data: {
            title: title,
            description: description,
          },
          success: function (response) {
            Swal.fire({
              title: "Notification Created Successfully",
              icon: "success",
            });
            fetchAndUpdateTable();
          },
          error: function (error) {
            Swal.fire({
              title: "Something went wrong!",
              icon: "error",
            });
          },
        });
      }

      $(document).ready(function () {
        function fetchAndUpdateTable() {
          $.ajax({
            type: "GET",
            url: "/api/webapi/get-Notification",
            dataType: "json",
            success: function (response) {
              updateTable(response);
            },
            error: function (xhr, status, error) {
              console.log("Error fetching data:", error);
            },
          });
        }

        function updateTable(data) {
          if (Array.isArray(data.data) && data.data.length > 0) {
            var tableBody = $("#tableget").find("tbody");
            tableBody.empty();
            data.data.forEach(function (item, i) {
              var row =
                "<tr>" +
                '<td class="text-center">' +
                (i + 1) +
                "</td>" +
                '<td class="text-center">' +
                item.heading +
                "</td>" +
                '<td class="text-center" style="width: 350px;">' +
                item.message +
                "</td>" +
                '<td class="text-center">' +
                // `<button class="btn btn-warning" onclick="showEditPopup(${item.id}, '${item.heading}', '${item.message}')">Edit</button>` +
                `<button class="btn btn-danger" onclick="deleteSubmit(${item.id})">Delete</button>` +
                "</td>" +
                "</tr>";
              tableBody.append(row);
            });
          } else {
            console.log("No data found or invalid response format");
          }
        }

        // Initial load of table data
        fetchAndUpdateTable();
      });

      function showEditPopup(id, title, description) {
        $("#title").val(title);
        $("#description").val(description);
        $("#editId").val(id);
        $("#editModal").modal("show");
      }

      function handleEdit() {
        let id = $("#editId").val();
        let title = $("#title").val().trim().replace(/\s+/g, " ");
        let description = $("#description").val().trim().replace(/\s+/g, " ");

        $.ajax({
          type: "PUT",
          url: `/api/webapi/admin/update-notification/${id}`,
          dataType: "JSON",
          data: {
            title: title,
            description: description,
          },
          success: function (response) {
            Swal.fire({
              title: "Notification Updated Successfully",
              icon: "success",
            });
            fetchAndUpdateTable();
            $("#editModal").modal("hide");
          },
          error: function (error) {
            Swal.fire({
              title: "Something went wrong!",
              icon: "error",
            });
          },
        });
      }

      function deleteSubmit(id) {
        Swal.fire({
          title: "Are you sure?",
          text: "You won't be able to revert this!",
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: "#3085d6",
          cancelButtonColor: "#d33",
          confirmButtonText: "Yes, delete it!",
        }).then((result) => {
          if (result.isConfirmed) {
            $.ajax({
              type: "POST",
              url: `/api/webapi/admin/delete-notification/${id}`,
              dataType: "json",
              success: function (response) {
                Swal.fire({
                  title: "Deleted Successfully",
                  icon: "success",
                });
                fetchAndUpdateTable();
              },
              error: function (error) {
                Swal.fire({
                  title: "Something went wrong!",
                  icon: "error",
                });
              },
            });
          }
        });
      }
    </script>

    <!-- Edit Modal -->
    <!-- <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="editModalLabel">Edit Notification</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <input type="hidden" id="editId" />
            <div class="mb-3">
              <label for="editTitle" class="form-label">Title</label>
              <input type="text" class="form-control" id="editTitle" required placeholder="Enter Title" />
            </div>
            <div class="mb-3">
              <label for="editDescription" class="form-label">Description</label>
              <textarea class="form-control" id="editDescription" required placeholder="Enter description" style="width: 100%; height: 150px"></textarea>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" onclick="handleEdit()">Save changes</button>
          </div>
        </div>
      </div>
    </div> -->
  </body>
</html>