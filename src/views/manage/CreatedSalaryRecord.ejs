<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Created Salary Record</title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback"
    />
    <link rel="stylesheet" href="/plugins/fontawesome-free/css/all.min.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      href="//cdn.jsdelivr.net/npm/@sweetalert2/theme-dark@4/dark.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/dist/css/adminlte.min.css" />
    <link rel="stylesheet" href="/css/admin.css" />
    <style>
      body {
        background-color: #f4f6f9;
        color: #343a40;
        font-family: "Source Sans Pro", sans-serif;
      }

      .content-wrapper {
        background-color: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      h1 {
        color: #343a40;
        margin-bottom: 20px;
      }

      .card {
        background-color: #ffffff;
        color: #343a40;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }

      .form-control {
        background-color: #ffffff;
        border: 1px solid #ced4da;
        border-radius: 5px;
        color: #495057;
      }

      .form-control:focus {
        border-color: #80bdff;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
      }

      .btn-primary {
        background-color: #605bff;
        border-color: #605bff;
        border-radius: 5px;
        transition: background-color 0.3s ease;
      }

      .btn-primary:hover {
        background-color: #4d49d7;
        border-color: #4d49d7;
      }

      .table {
        background-color: #ffffff;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      .table th,
      .table td {
        text-align: center;
        vertical-align: middle;
      }

      tbody tr:nth-child(even) {
        background: #fafafb !important;
      }

      tbody tr:nth-child(odd) {
        background: #f3f2ff !important;
      }

      thead tr {
        background-color: #605bff; /* Sets the background for the table header row */
      }

      thead th {
        background-color: #605bff; /* Sets the background for individual header cells */
        color: white; /* Optional: Set text color for better contrast */
      }

      .card-title {
        color: #605bff;
        font-size: 20px;
        font-weight: bold;
        margin: 10px;
      }

      .container1 {
        display: flex;
        flex-direction: row;
        gap: 20px;
      }

      @media (max-width: 768px) {
        .container1 {
          display: flex;
          flex-direction: column;
          gap: 20px;
        }
      }

      .section {
        width: 100%;
        background: #ffffff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }

      .form-section h2 {
        margin-bottom: 20px;
        font-size: 20px;
        color: #333;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        font-weight: bold;
        margin-bottom: 5px;
        color: #555;
      }

      .form-group input,
      .form-group select {
        width: 100%;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 20px;
      }

      .form-group input:focus,
      .form-group select:focus {
        border-color: #007bff;
        outline: none;
      }

      .form-submit {
        display: inline-block;
        background: #053a73;
        color: #fff;
        padding: 10px 15px;
        font-size: 20px;
        border: none;
        width: 18rem;
        height: 10vh;
        border-radius: 5px;
        cursor: pointer;
        transition: transform 0.3s ease;
      }

      .form-submit:hover {
        background: #0056b3;
      }

      .box-container {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        gap: 20px;
        flex-wrap: wrap; /* Allow wrapping for responsiveness */
      }

      .box {
        flex: 1;
        padding: 20px;
        background: #d0e3fa;
        border-radius: 8px;
        text-align: center;
        color: #605bff;
        height: 10rem;
        margin-top: 20px; /* Adjusted margin for better spacing */
        font-size: 18px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
      }

      .box:hover {
        transform: translateY(-10px);
      }

      @media (max-width: 768px) {
        .box {
          flex-basis: 100%; /* Full width on smaller screens */
          margin-top: 10px; /* Adjust margin for smaller screens */
        }
      }
    </style>
  </head>

  <body class="hold-transition sidebar-mini">
    <div class="wrapper">
      <!-- Include navigation -->
      <%- include('nav') %>
      <div class="content-wrapper">
        <section class="content-header">
          <div class="container-fluid">
            <div class="row mb-2">
              <div class="col-sm-6">
                <h1
                  class=""
                  style="color: #605bff; font-size: 2rem; font-weight: bold"
                >
                  Created Salary Record
                </h1>
              </div>
            </div>
          </div>
        </section>

        <div class="container1">
          <!-- Section 1: Form -->
          <div class="section form-section box-bg">
            <h2 style="color: #605bff">Created Salary Record</h2>
            <form id="salaryForm">
              <div class="form-group">
                <label for="phone">UID</label>
                <input
                  type="tel"
                  id="phone"
                  name="phone"
                  placeholder="Enter UID"
                  required
                />
              </div>
              <div class="form-group">
                <label for="amount">Amount</label>
                <input
                  type="number"
                  id="amount"
                  name="amount"
                  placeholder="Enter amount"
                  required
                />
              </div>
              <div class="form-group">
                <label for="type">Type</label>
                 <input
                  type="text"
                  id="type"
                  name="type"
                  placeholder="Enter text"
                  required
                />
              </div>
              <button type="submit" class="form-submit">Submit</button>
            </form>
          </div>

          <!-- Section 2: Boxes -->
          <div
            class="section box-container"
            style="
              background: linear-gradient(
                to right,
                rgb(137, 104, 255),
                rgb(175, 152, 255)
              );
            "
          >
            <div class="box" id="">
              <p>Daily Selery</p>
              <p class="" id="dailySelery">0</p>
            </div>

            <div class="box" id="">
              <p>Monthly Selery</p>
              <p class="" id="monthlySelery">0</p>
            </div>

            <div class="box" id="">
              <p>Yearsly Selery</p>
              <p class="" id="yearslySelery">0</p>
            </div>
          </div>
        </div>

        <!-- Main content -->
        <!-- Modified Table Section -->
        <section class="content">
          <div class="card">
            <div class="card-body p-0">
              <h5 class="card-title">Salary Records Table</h5>
              <div class="table-responsive">
                <!-- Added table-responsive wrapper -->
                <table class="table" id="tableget">
                  <thead>
                    <tr>
                      <th class="text-center">Phone</th>
                      <th class="text-center">Amount</th>
                      <th class="text-center">Type</th>
                      <th class="text-center">Time</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- Table rows dynamically added here -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>

    <!-- Include scripts -->
    <script src="/plugins/jquery/jquery.min.js"></script>
    <script src="/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="/dist/js/adminlte.min.js"></script>
    <script src="/js/admin/admin.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
    <script>
      $(document).ready(function () {
        $("#salaryForm").on("submit", function (e) {
          e.preventDefault();

          let phoneNumber = $("#phone").val().trim();
          let amount = $("#amount").val().trim();
          let type = $("#type").val().trim();

          console.log("phone:", phoneNumber);
          console.log("amount", amount);
          console.log("type", type);

          $.ajax({
            type: "POST",
            url: "/api/webapi/admin/CreatedSalary",
            dataType: "JSON",
            data: {
              phone: phoneNumber,
              amount: amount,
              type: type,
            },
            success: function (response) {
              // Handle success, e.g., show a success message
              console.log("Response data success:", response.message);
              Swal.fire({
                title: "UPDATED SUCCESSFULLY",
                icon: "success",
              });
              document.getElementById("salaryForm").reset();
              // Fetch the updated data and reload the table
              fetchAndUpdateTable();
            },
            error: function (error) {
              // Handle error, e.g., show an error message
              console.log("Response data error:", JSON.stringify(error));
              Swal.fire({
                title: "Something went wrong!",
                icon: "error",
              });
            },
          });
        });

        // Function to fetch and update the table data
        function fetchAndUpdateTable() {
          $.ajax({
            type: "GET",
            url: "/api/webapi/admin/getSalary",
            dataType: "json",
            success: function (response) {
              if (response) {
                $("#dailySelery").text(response.totalDailySalary);
                $("#monthlySelery").text(response.totalMonthlySalary);
                $("#yearslySelery").text(response.totalEarlySalary);
              } else {
                console.log("No data found or invalid response format");
                return;
              }
              console.log("responsessss", response);
              // Update the table with the new data
              updateTable(response);
            },
            error: function (xhr, status, error) {
              console.log("Error fetching data:", error);
            },
          });
        }

        // Function to update the table with new data
        function updateTable(data) {
          if (Array.isArray(data.rows) && data.rows.length > 0) {
            var tableBody = $("#tableget").find("tbody");
            tableBody.empty();

            data.rows.forEach(function (item) {
              var row =
                "<tr>" +
                '<td class="text-center">' +
                item.phone +
                "</td>" +
                '<td class="text-center">' +
                item.amount +
                "</td>" +
                '<td class="text-center">' +
                item.type +
                "</td>" +
                '<td class="text-center">' +
                item.time +
                "</td>" +
                "</tr>";
              tableBody.append(row);
            });
          } else {
            console.log("No data found or invalid response format");
          }
        }

        // Initial load of table data
        fetchAndUpdateTable();
      });
    </script>
  </body>
</html>
